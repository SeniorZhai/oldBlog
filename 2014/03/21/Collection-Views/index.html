<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Collection Views | SeniorZhai&#39;s blog | 苟利国家生死以，起因福祸趋避之</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  <meta name="theme-color" content="#ED5565">
  
  
  <meta name="keywords" content="iOS">
  <meta name="description" content="##什么是UICollectionViewUICollectionView是一种新的数据展示方式，简单来说可以把他理解成多列的UITableView。比如iBooks，一个虚拟的书架上放着各类图书，排列整齐，亦或者iPad的iOS6中的原生时钟中的各个时钟，也是UICollectionView的最简单的一个布局。

最简单的UICollectionView就是一个GirdView，可以以多列的方">
<meta property="og:type" content="article">
<meta property="og:title" content="Collection Views">
<meta property="og:url" content="http://seniorzhai.github.io/2014/03/21/Collection-Views/index.html">
<meta property="og:site_name" content="SeniorZhai's blog">
<meta property="og:description" content="##什么是UICollectionViewUICollectionView是一种新的数据展示方式，简单来说可以把他理解成多列的UITableView。比如iBooks，一个虚拟的书架上放着各类图书，排列整齐，亦或者iPad的iOS6中的原生时钟中的各个时钟，也是UICollectionView的最简单的一个布局。

最简单的UICollectionView就是一个GirdView，可以以多列的方">
<meta property="og:image" content="https://github.com/zt1991616/blog/raw/master/Image/14032101.png">
<meta property="og:image" content="https://github.com/zt1991616/blog/raw/master/Image/14032102.png">
<meta property="og:image" content="https://github.com/zt1991616/blog/raw/master/Image/14032103.png">
<meta property="og:image" content="https://github.com/zt1991616/blog/raw/master/Image/14032104.png">
<meta property="og:updated_time" content="2015-08-25T03:13:07.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Collection Views">
<meta name="twitter:description" content="##什么是UICollectionViewUICollectionView是一种新的数据展示方式，简单来说可以把他理解成多列的UITableView。比如iBooks，一个虚拟的书架上放着各类图书，排列整齐，亦或者iPad的iOS6中的原生时钟中的各个时钟，也是UICollectionView的最简单的一个布局。

最简单的UICollectionView就是一个GirdView，可以以多列的方">
<meta name="twitter:image" content="https://github.com/zt1991616/blog/raw/master/Image/14032101.png">
  
    <link rel="alternative" href="/atom.xml" title="SeniorZhai&#39;s blog" type="application/atom+xml">
  
  <meta name="summary" content="专注于移动平台">
  <link rel="shortcut icon" href="/img/favicon.ico">
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div id="loading" class="active"></div>

  <nav id="menu" class="hide" >
   <div class="inner flex-row-vertical">
  <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
      <i class="icon icon-lg icon-close"></i>
  </a>
  <div class="brand-wrap">
    <div class="brand">
      <a href="/" class="avatar"><img src="/img/logo.jpg"></a>
      <hgroup class="introduce">
        <h5 class="nickname">Dear宅学长</h5>
        <a href="mailto:developer.zhaitao@gmail.com" title="developer.zhaitao@gmail.com" class="mail">developer.zhaitao@gmail.com</a>
      </hgroup>
    </div>
  </div>
  <div class="scroll-wrap flex-col">
    <ul class="nav">
      
          <li class="waves-block waves-effect">
            <a href="/"  >
              <i class="icon icon-lg icon-home"></i>
              主页
            </a>
          </li>
      
          <li class="waves-block waves-effect">
            <a href="/archives"  >
              <i class="icon icon-lg icon-archives"></i>
              Archives
            </a>
          </li>
      
          <li class="waves-block waves-effect">
            <a href="/tags"  >
              <i class="icon icon-lg icon-tags"></i>
              Tags
            </a>
          </li>
      
          <li class="waves-block waves-effect">
            <a href="https://seniorzhai.github.io" target="_blank" >
              <i class="icon icon-lg icon-github"></i>
              Github
            </a>
          </li>
      
          <li class="waves-block waves-effect">
            <a href="http://weibo.com/seniorszhai/" target="_blank" >
              <i class="icon icon-lg icon-weibo"></i>
              Weibo
            </a>
          </li>
      
          <li class="waves-block waves-effect">
            <a href="/about"  >
              <i class="icon icon-lg icon-link"></i>
              about
            </a>
          </li>
      
    </ul>

    <footer class="footer">
  <p><a rel="license" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="Creative Commons License" style="border-width:0;vertical-align:middle;" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAAAPCAMAAABEF7i9AAAAllBMVEUAAAD///+rsapERER3d3eIiIjMzMzu7u4iIiKUmZO6v7rKzsoODg4RERFVVVUNDQ0NDg0PEA8zMzNLTEtbXltmZmZydnF9gn2AgICPkI+ZmZmqqqq7u7vFxsXIzMgNDQwZGRkgICAhISEkJSMnKCcuMC4xMzE5Ozk7PTtBQkFCQkJDQ0Nna2eGhoaHh4ezuLLGysbd3d1wVGpAAAAA4UlEQVR42q2T1xqCMAyFk7QsBQeKA9x7j/d/OSm22CpX0nzcpA1/T05aAOuBVkMAScQFHLnEwoCo2f1TnQIGoVMewjZEjVFN4GH1Ue1Cn2jWqwfsOOj6wDwGvotsl/c8lv7KIq1eLOsT0HMFHMIE/RZyHnlphryT9zyV+8WH5e8yQw3wnQvgAFxPTKUVi555SHR/lOfLMgVTeDlSfN+TaoUsiTyeIm+bCkHvCA2FUKG48LDtYBZBknsYP/G8NTw0gaaHyuQf4H5pecrB/FYCT2sL9zAfy1Xyjou6L8X2W7YcLyBZCRtnq/zfAAAAAElFTkSuQmCC" /></a></p>
  <p>SeniorZhai&#39;s blog &copy; 2016</p>
  <p>Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme
  <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a></p>
  <a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-2x icon-rss-square"></i></a>
</footer>

  </div>
</div>

  </nav>
  <main id="main">
    <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">Collection Views</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input " autocomplete="off" placeholder="输入感兴趣的关键字">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-share">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header">
  <div class="container">
    <h1 class="author">Collection Views</h1>
    <h5 class="subtitle">
        
            <time datetime="2014-03-21T04:59:00.000Z" itemprop="datePublished" class="page-time">
  2014-03-21
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/iOS/">iOS</a></li></ul>

        
    </h5>
  </div>
</header>

    <div class="container body-wrap">
      <article id="post-Collection-Views" 
  class="article article-type-post" itemprop="blogPost">
    <div class="post-meta flex-row">
        
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/iOS/">iOS</a></li></ul>

    </div>
    <div class="post-body">
        <aside class="post-widget" id="post-widget">

            
            <div class="post-share" id="post-share">
    <div class="tit">分享到：</div>
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" href="javascript:;" data-title="微博" data-service="tsina">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns" href="javascript:;" data-title="微信" data-service="weixin">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" href="javascript:;" data-title=" QQ" data-service="cqq">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" href="javascript:;" data-title=" Facebook" data-service="fb">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" href="javascript:;" data-title=" Twitter" data-service="twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="douban share-sns" href="javascript:;" data-title="豆瓣" data-service="douban">
          豆
        </a>
      </li>
    </ul>
 </div>

            

            
            <nav class="post-toc-wrap" id="post-toc">
            
            </nav>
            
        </aside>

        <div class="post-main">

            <div class="post-content" id="post-content" itemprop="postContent">
            <p><img src="https://github.com/zt1991616/blog/raw/master/Image/14032101.png" alt=""></p>
<p>##什么是UICollectionView<br>UICollectionView是一种新的数据展示方式，简单来说可以把他理解成多列的UITableView。比如iBooks，一个虚拟的书架上放着各类图书，排列整齐，亦或者iPad的iOS6中的原生时钟中的各个时钟，也是UICollectionView的最简单的一个布局。</p>
<p><img src="https://github.com/zt1991616/blog/raw/master/Image/14032102.png" alt=""></p>
<p>最简单的UICollectionView就是一个GirdView，可以以多列的方式来将数据进行展示，标准的UICollection包含三个部分：</p>
<ul>
<li>Cells用于展示内容的主体，对于不同的cell可以指定不同尺寸和不同的内容</li>
<li>Supplementary Views追加视图，用来标记每个section的view</li>
<li>Decoration Views装饰视图，每个section的背景</li>
</ul>
<p><img src="https://github.com/zt1991616/blog/raw/master/Image/14032103.png" alt=""><br><img src="https://github.com/zt1991616/blog/raw/master/Image/14032104.png" alt=""></p>
<p>##实现一个简单的UICollectionView</p>
<p>和UITableView一样，UICollectionView同样采用datasource和delegate设计模式：datasource为View提供数据源，告诉View要实现什么及如何显示它们，delegate提供一些样式的小细节以及用户交互的相应。</p>
<p>###UICollectionViewDataSource</p>
<ul>
<li><ul>
<li>(NSInteger)collectionView:(UICollectionView *)view numberOfItemsInSection:(NSInteger)section:section的数量</li>
</ul>
</li>
<li><ul>
<li>(NSInteger)collectionView:(UICollectionView *)collectionView numberOfItemsInSection:(NSInteger)section:某个section里有多少个item</li>
</ul>
</li>
<li><ul>
<li>(UICollectionViewCell <em>)collectionView:(UICollectionView </em>)collectionView cellForItemAtIndexPath:(NSIndexPath *)indexPath:指定显示什么样的cell</li>
</ul>
</li>
</ul>
<p>实现了以上三个委托方法，基本上就可以保证CollectionView工作正常，同时还通过了Supplementary View方法</p>
<ul>
<li><ul>
<li>(UICollectionReusableView <em>)collectionView:(UICollectionView </em>)collectionView viewForSupplementaryElementOfKind:(NSString <em>)kind atIndexPath:(NSIndexPath </em>)indexPath</li>
</ul>
</li>
</ul>
<p>####用于重用</p>
<p>在UICollectionView中在请求数据源之前要注册CellView、SupplementaryView，可以通过以下方法进行注册<br>-registerClass:forCellWithReuseIdentifier:<br>-registerClass:forSupplementaryViewOfKind:withReuseIdentifier:<br>-registerNib:forCellWithReuseIdentifier:<br>-registerNib:forSupplementaryViewOfKind:withReuseIdentifier:</p>
<p>###UICollectionViewDelegate<br>负责交互</p>
<ul>
<li>cell的高亮</li>
<li>cell的选中状态</li>
<li>可以支持长按后的菜单<br>用户点击cell的时候，现在会按照以下流程向delegate进行询问：</li>
</ul>
<ol>
<li><ul>
<li>collectionView:shouldHighlightItemAtIndexPath:是否应该高亮？</li>
</ul>
</li>
<li><ul>
<li>collectionView:didHighlightItemAtIndexPath:如果1回答是，那么高亮</li>
</ul>
</li>
<li><ul>
<li>collectionView:shouldSelectItemAtIndexPath:无论1结果如何，都询问是否可以被选中？</li>
</ul>
</li>
<li><ul>
<li>collectionView:didUnhighlightItemAtIndexPath:如果1回答是否，那么取消高亮</li>
</ul>
</li>
<li><ul>
<li>collectionView:didSelectItemAtIndexPath:如果3回答为是，那么选中cell</li>
</ul>
</li>
</ol>
<p>对应的高亮和选中状态分别由highlighted和selected两个属性表示。</p>
<p>###关于cell</p>
<p>UICollectionViewCell相比UITableViewCell没有太多的花头，首先不存在格式各样的默认的style。UICollectionViewCell结构上相对比较简单，由下至上：</p>
<ol>
<li>cell本身作为容器View</li>
<li>一个大小自动适应整个cell的backgroundView，用于cell默认的背景</li>
<li>selectedBackgroundView，是cell被选中时的背景</li>
<li>contentView，自定义内容应被加载这个View上。</li>
</ol>
<p>###UICollectionViewLayout<br>负责各个cell、Supplementary View和Decoration Views进行组织，为了它们设定各自的属性，包括但不限于：位置、尺寸、透明度、层级关系、形状、等等…</p>
<ul>
<li>Layout决定了UICollectionView是如何显示在界面上的。在展示之前，一般需要生成合适的UICollectionViewLayout子类对象，并将其赋予CollectionView的collectionViewLayout属性。</li>
</ul>
<p>默认常用的Layout是UICollectionViewFlowLayout，是一个直线对齐的Layout。</p>
<ul>
<li>itemSize，定义了每一个item的大小。通过设定itemSize可以全局改变所有cell的尺寸，如果想要对某个cell定制尺寸，可以使用-collectionView:layout:sizeForItemAtIndexPath:方法。</li>
<li>间隔 指定每个item之间的间隔和每一行之间的间隔，和size类似，有全局属性，也可以对每一个item和每一个section做出设定：<ul>
<li>@property (CGSize) minimumInteritemSpacing</li>
<li>@property (CGSize) minimumLineSpacing</li>
<li>-collectionView:layout:minimumInteritemSpacingForSectionAtIndex:</li>
<li>-collectionView:layout:minimumLineSpacingForSectionAtIndex:</li>
</ul>
</li>
<li>滚动方向 由属性scrollDirection确定scroll View的方向，将影响Flow Layout的基本方向和由header及footer确定的section之间的宽度<ul>
<li>UICollectionViewScrollDirectionVertical</li>
<li>UICollectionViewScrollDirectionHorizontal</li>
</ul>
</li>
<li>Header和Footer尺寸 分为全局和部分，需要注意根据滚动方向不同，header和footer的高和宽中只有一个和会起作用，垂直滚动时section间宽度为该迟钝的高，而水平滚动时为宽度起作用<ul>
<li>@property (CGSize) headerReferenceSize</li>
<li>@property (CGSize) footerReferenceSize</li>
<li>-collectionView:layout:referenceSizeForHeaderInSection:</li>
<li>-collectionView:layout:referenceSizeForFooterInSection:</li>
</ul>
</li>
<li>缩进<ul>
<li>@property UIEdgeInsets sectionInset;</li>
<li>-collectionView:layout:insetForSectionAtIndex:<br>#自定义UICollectionViewLayout</li>
</ul>
</li>
</ul>
<p><strong>总结</strong><br>一个UICollectionView的实现包括两个必要部分：UICollectionViewDataSource和UICollectionViewLayout，和一个交互部分：UICollectionViewDelegate。而Apple给出的UICollectionViewFlowLayout已经是一个很强力的layout方案了。</p>
<p>#UICollectionViewLayoutAttributes<br>property列表：</p>
<ul>
<li>@property (nonatomic) CGRect frame</li>
<li>@property (nonatomic) CGPoint center</li>
<li>@property (nonatomic) CGSize size</li>
<li>@property (nonatomic) CATransform3D transform3D</li>
<li>@property (nonatomic) CGFloat alpha</li>
<li>@property (nonatomic) NSInteger zIndex</li>
<li>@property (nonatomic, getter=isHidden) BOOL hidden</li>
</ul>
<p>UICollectionViewLayoutAttributes的实例中包含了诸如边框，中心点，大小，形状，透明度，层次关系和是否隐藏等信息。当UICollectionView在获取布局时将针对每一个indexPath的部件（包括cell，追加视图和装饰视图），向其上的UICollectionViewLayout实例询问该部件的布局信息。这个布局信息，就以UICollectionViewLayoutAttributes的实例的方式给出。</p>
<p>#UICollectionViewLayout<br>UICollectionViewLayout的功能为向UICollectionView提供布局信息，不仅包括cell的布局信息，也包括追加视图和装饰视图的布局信息。实现一个自定义layou的常规做法是继承UICollectionViewLayout类，然后重载下列方法。</p>
<ul>
<li><ul>
<li>(CGSize)collectioonViewContentSize<ul>
<li>返回collctionView的内容尺寸</li>
</ul>
</li>
</ul>
</li>
<li><ul>
<li>(NSArray *)layoutAttributesForElementsInRect:(CGRect)rect<ul>
<li>返回rect中的所有的元素的布局属性</li>
<li>返回的包括UICollectionViewLayoutAttributes的NSArray</li>
<li>UICollctionViewLayoutAttributes可以是cell，追加视图或装饰视图的信息，通过不同的UICollectionViewLayoutAttributes初始化方法可以得到不同类型的UICollctionViewLayoutAttributes<ul>
<li>ayoutAttributesForCellWithIndexPath:</li>
<li>layoutAttributesForSupplementaryViewOfKind:withIndexPath:</li>
<li>layoutAttributesForDecorationViewOfKind:withIndexPath:</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><ul>
<li>(UICollectionViewLayoutAttributes <em>)layoutAttributesForItemAtIndexPath:(NSIndexPath </em>)indexPath<ul>
<li>返回对应indexPath位置的cell布局属性</li>
</ul>
</li>
</ul>
</li>
<li><ul>
<li>(UICollectionViewLayoutAttributes <em>)layoutAttributesForDecorationViewOfKind:(NSString </em>)decorationViewKind atIndexPath:(NSIndexPath *)indexPath<ul>
<li>返回对应indexPath位置的追加视图的布局属性，如果没有追加视图可以不重载</li>
</ul>
</li>
</ul>
</li>
<li><ul>
<li>(UICollectionViewLayoutAttributes <em>)layoutAttributesForDecorationViewOfKind:(NSString </em>)decorationViewKind atIndexPath:(NSIndexPath *)indexPath<ul>
<li>返回对应于indexPath的位置的装饰视图的布局属性，如果没有装饰视图可不重载</li>
</ul>
</li>
</ul>
</li>
<li><ul>
<li>(BOOL)shouldInvalidateLayoutForBoundsChange:(CGRect)newBounds<ul>
<li>当边界发生改变时，是否应该刷新布局。</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>在初始化一个UICollectionViewLayout实例后，会有一系列的准备方法被自动调用，以保证layout实例的正确</p>
<ol>
<li>-(void)prepareLayout，默认下该方法是每都不做，但是在自己的子类实现中，一般在该方法中设定一些必要的layout的结构和初始需要的参数等。</li>
<li>-(CGSize)collectionViewContentSize，以确定collection应该占据的尺寸，注意这里的尺寸不是指可使部分的尺寸，而是所有内容所占的尺寸。</li>
<li>-(NSArray *)layoutAttributesForElementsInRect:(Rect)rect被调用，初始的layout外观将由该方法返回的UICollctionViewLayoutAttributes来决定。</li>
</ol>
<p>另外，在需要更新layout时，需要给当前layout发送 -invalidateLayout，该消息会立即返回，并且预约在下一个loop的时候刷新当前layout。在-invalidateLayout后的下一个collectionView的刷新loop中，又会从prepareLayout开始，依次再调用-collectionViewContentSize和-layoutAttributesForElementsInRect来生成更新后的布局。</p>
<p>###LineLayout——对于个别UICollectionViewLayoutAttributes的调整</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div></pre></td><td class="code"><pre><div class="line">// LinrLayout.m</div><div class="line">#import &quot;LineLayout.h&quot;</div><div class="line"></div><div class="line"></div><div class="line">#define ITEM_SIZE 200.0</div><div class="line">#define ACTIVE_DISTANCE 200</div><div class="line">#define ZOOM_FACTOR 0.4</div><div class="line"></div><div class="line">@implementation LineLayout</div><div class="line"></div><div class="line">-(id)init</div><div class="line">&#123;</div><div class="line">    self = [super init];</div><div class="line">    if (self) &#123;</div><div class="line">        self.itemSize = CGSizeMake(ITEM_SIZE, ITEM_SIZE);</div><div class="line">        self.scrollDirection = UICollectionViewScrollDirectionHorizontal;</div><div class="line">        //  确定了缩进，此处为上方、下方各缩进200</div><div class="line">        self.sectionInset = UIEdgeInsetsMake(ITEM_SIZE, ITEM_SIZE/2, ITEM_SIZE, ITEM_SIZE/2);</div><div class="line">        //  每个item在水平方向的最小间距</div><div class="line">        self.minimumLineSpacing = ITEM_SIZE/4;</div><div class="line">        </div><div class="line">    &#125;</div><div class="line">    return self;</div><div class="line">&#125;</div><div class="line">// 边界改变时是否重新排版</div><div class="line">- (BOOL)shouldInvalidateLayoutForBoundsChange:(CGRect)oldBounds</div><div class="line">&#123;</div><div class="line">    return YES;</div><div class="line">&#125;</div><div class="line">//  初始的layout外观将由该方法返回的UICollctionViewLayoutAttributes来决定</div><div class="line">-(NSArray*)layoutAttributesForElementsInRect:(CGRect)rect</div><div class="line">&#123;</div><div class="line">    NSArray* array = [super layoutAttributesForElementsInRect:rect];</div><div class="line">    CGRect visibleRect;</div><div class="line">    visibleRect.origin = self.collectionView.contentOffset;</div><div class="line">    visibleRect.size = self.collectionView.bounds.size;</div><div class="line">    for (UICollectionViewLayoutAttributes* attributes in array) &#123;</div><div class="line">        if (CGRectIntersectsRect(attributes.frame, rect)) &#123;</div><div class="line">            CGFloat distance = CGRectGetMidX(visibleRect) - attributes.center.x;</div><div class="line">            CGFloat normalizedDistance = distance / ACTIVE_DISTANCE;</div><div class="line">            if (ABS(distance) &lt; ACTIVE_DISTANCE) &#123;</div><div class="line">                CGFloat zoom = 1 + ZOOM_FACTOR*(1 - ABS(normalizedDistance));</div><div class="line">                attributes.transform3D = CATransform3DMakeScale(zoom, zoom, 1.0);</div><div class="line">                attributes.zIndex = 1;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    return array;</div><div class="line">&#125;</div><div class="line"></div><div class="line">//  自动对齐到网格</div><div class="line">- (CGPoint)targetContentOffsetForProposedContentOffset:(CGPoint)proposedContentOffset withScrollingVelocity:(CGPoint)velocity</div><div class="line">&#123;</div><div class="line">    //  proposedContentOffset是没有对齐到网格时本来应该停下来的位置</div><div class="line">    CGFloat offsetAdjustment = MAXFLOAT;</div><div class="line">    CGFloat horizontalCenter = proposedContentOffset.x + (CGRectGetWidth(self.collectionView.bounds) / 2.0);</div><div class="line">    //  当前显示的区域</div><div class="line">    CGRect targetRect = CGRectMake(proposedContentOffset.x, 0.0, self.collectionView.bounds.size.width, self.collectionView.bounds.size.height);</div><div class="line">    //  取当前显示的item</div><div class="line">    NSArray* array = [super layoutAttributesForElementsInRect:targetRect];</div><div class="line">    //  对当前屏幕中的UICollectionViewLayoutAttributes逐个与屏幕中心进行比较，找出最接近中心的一个</div><div class="line">    for (UICollectionViewLayoutAttributes* layoutAttributes in array) &#123;</div><div class="line">        CGFloat itemHorizontalCenter = layoutAttributes.center.x;</div><div class="line">        if (ABS(itemHorizontalCenter - horizontalCenter) &lt; ABS(offsetAdjustment)) &#123;</div><div class="line">            offsetAdjustment = itemHorizontalCenter - horizontalCenter;</div><div class="line">        &#125;</div><div class="line">    &#125;    </div><div class="line">    return CGPointMake(proposedContentOffset.x + offsetAdjustment, proposedContentOffset.y);</div><div class="line">&#125;</div><div class="line"></div><div class="line">@end</div></pre></td></tr></table></figure>
<p><a href="https://github.com/zt1991616/LineLayout" target="_blank" rel="external">例子</a></p>
<p>###CircleLayout——完全自定义的Layout，添加删除item，以及手势识别</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div></pre></td><td class="code"><pre><div class="line">#import &quot;CircleLayout.h&quot;</div><div class="line"></div><div class="line">#define ITEM_SIZE 70</div><div class="line"></div><div class="line">@implementation CircleLayout</div><div class="line"></div><div class="line">// 准备计算需要的参数</div><div class="line">-(void)prepareLayout</div><div class="line">&#123;</div><div class="line">    [super prepareLayout];</div><div class="line">    </div><div class="line">    CGSize size = self.collectionView.frame.size;</div><div class="line">    _cellCount = [[self collectionView] numberOfItemsInSection:0];</div><div class="line">    // 中心点</div><div class="line">    _center = CGPointMake(size.width / 2.0, size.height / 2.0);</div><div class="line">    // 半径</div><div class="line">    _radius = MIN(size.width, size.height) / 2.5;</div><div class="line">&#125;</div><div class="line">// collctionView的内容大小就是collectionView的大小</div><div class="line">-(CGSize)collectionViewContentSize</div><div class="line">&#123;</div><div class="line">    return [self collectionView].frame.size;</div><div class="line">&#125;</div><div class="line">// 通过所在的indexPath确定位置</div><div class="line">- (UICollectionViewLayoutAttributes *)layoutAttributesForItemAtIndexPath:(NSIndexPath *)path</div><div class="line">&#123;</div><div class="line">    UICollectionViewLayoutAttributes* attributes = [UICollectionViewLayoutAttributes layoutAttributesForCellWithIndexPath:path];</div><div class="line">    attributes.size = CGSizeMake(ITEM_SIZE, ITEM_SIZE);</div><div class="line">    // 配置attributes到圆周上</div><div class="line">    attributes.center = CGPointMake(_center.x + _radius * cosf(2 * path.item * M_PI / _cellCount),</div><div class="line">                                    _center.y + _radius * sinf(2 * path.item * M_PI / _cellCount));</div><div class="line">    return attributes;</div><div class="line">&#125;</div><div class="line">// 用来在一开始给出一套UICollectionViewLayoutAttributes</div><div class="line">-(NSArray*)layoutAttributesForElementsInRect:(CGRect)rect</div><div class="line">&#123;</div><div class="line">    NSMutableArray* attributes = [NSMutableArray array];</div><div class="line">    for (NSInteger i=0 ; i &lt; self.cellCount; i++) &#123;</div><div class="line">        //</div><div class="line">        NSIndexPath* indexPath = [NSIndexPath indexPathForItem:i inSection:0];</div><div class="line">        [attributes addObject:[self layoutAttributesForItemAtIndexPath:indexPath]];</div><div class="line">    &#125;    </div><div class="line">    return attributes;</div><div class="line">&#125;</div><div class="line">// 插入前，cell在圆心位置，全透明</div><div class="line">- (UICollectionViewLayoutAttributes *)initialLayoutAttributesForInsertedItemAtIndexPath:(NSIndexPath *)itemIndexPath</div><div class="line">&#123;</div><div class="line">    UICollectionViewLayoutAttributes* attributes = [self layoutAttributesForItemAtIndexPath:itemIndexPath];</div><div class="line">    attributes.alpha = 0.0;</div><div class="line">    attributes.center = CGPointMake(_center.x, _center.y);</div><div class="line">    return attributes;</div><div class="line">&#125;</div><div class="line"></div><div class="line">// 删除时，cell在圆心位置，全透明，且只有原来的1/10大</div><div class="line">- (UICollectionViewLayoutAttributes *)finalLayoutAttributesForDeletedItemAtIndexPath:(NSIndexPath *)itemIndexPath</div><div class="line">&#123;</div><div class="line">    UICollectionViewLayoutAttributes* attributes = [self layoutAttributesForItemAtIndexPath:itemIndexPath];</div><div class="line">    attributes.alpha = 0.0;</div><div class="line">    attributes.center = CGPointMake(_center.x, _center.y);</div><div class="line">    attributes.transform3D = CATransform3DMakeScale(0.1, 0.1, 1.0);</div><div class="line">    return attributes;</div><div class="line">&#125;</div><div class="line"></div><div class="line">@end</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div></pre></td><td class="code"><pre><div class="line">#import &quot;ViewController.h&quot;</div><div class="line">#import &quot;Cell.h&quot;</div><div class="line"></div><div class="line">@implementation ViewController</div><div class="line"></div><div class="line">-(void)viewDidLoad</div><div class="line">&#123;</div><div class="line">    self.cellCount = 20;</div><div class="line">    // 添加一个手势识别</div><div class="line">    UITapGestureRecognizer* tapRecognizer = [[UITapGestureRecognizer alloc] initWithTarget:self action:@selector(handleTapGesture:)];</div><div class="line">    [self.collectionView addGestureRecognizer:tapRecognizer];</div><div class="line">    [self.collectionView registerClass:[Cell class] forCellWithReuseIdentifier:@&quot;MY_CELL&quot;];</div><div class="line">    [self.collectionView reloadData];</div><div class="line">    self.collectionView.backgroundColor = [UIColor greenColor];</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (NSInteger)collectionView:(UICollectionView *)view numberOfItemsInSection:(NSInteger)section;</div><div class="line">&#123;</div><div class="line">    return self.cellCount;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (UICollectionViewCell *)collectionView:(UICollectionView *)cv cellForItemAtIndexPath:(NSIndexPath *)indexPath;</div><div class="line">&#123;</div><div class="line">    Cell *cell = [cv dequeueReusableCellWithReuseIdentifier:@&quot;MY_CELL&quot; forIndexPath:indexPath];</div><div class="line">    return cell;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)handleTapGesture:(UITapGestureRecognizer *)sender &#123;</div><div class="line">    </div><div class="line">    if (sender.state == UIGestureRecognizerStateEnded)</div><div class="line">    &#123;</div><div class="line">        CGPoint initialPinchPoint = [sender locationInView:self.collectionView];</div><div class="line">        NSIndexPath* tappedCellPath = [self.collectionView indexPathForItemAtPoint:initialPinchPoint];</div><div class="line">        // 点击处没有cell</div><div class="line">        if (tappedCellPath!=nil)</div><div class="line">        &#123;</div><div class="line">            self.cellCount = self.cellCount - 1;</div><div class="line">            [self.collectionView performBatchUpdates:^&#123;</div><div class="line">                [self.collectionView deleteItemsAtIndexPaths:[NSArray arrayWithObject:tappedCellPath]];</div><div class="line">                </div><div class="line">            &#125; completion:nil];</div><div class="line">        &#125;</div><div class="line">        else</div><div class="line">        &#123;</div><div class="line">            self.cellCount = self.cellCount + 1;</div><div class="line">            [self.collectionView performBatchUpdates:^&#123;</div><div class="line">                [self.collectionView insertItemsAtIndexPaths:[NSArray arrayWithObject:[NSIndexPath indexPathForItem:0 inSection:0]]];</div><div class="line">            &#125; completion:nil];</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">@end</div></pre></td></tr></table></figure>
<p><a href="https://github.com/zt1991616/CircleLayout" target="_blank" rel="external">例子</a></p>

            <blockquote>
                <p>
                本文地址：
                <a href="http://seniorzhai.github.io/2014/03/21/Collection-Views/" target="_blank" rel="external">http://seniorzhai.github.io/2014/03/21/Collection-Views/</a>
                </p>
                <footer><cite><a href="http://seniorzhai.github.io">@SeniorZhai's blog</a></cite></footer>
            </blockquote>
            </div>
            
<nav class="post-nav">
  
    <div class="waves-block waves-effect prev fl">
      <a href="/2014/03/21/Android-ADB常用命令/" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">Android ADB常用命令</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next fr">
      <a href="/2014/03/20/KVO/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">KVO</h4>
      </a>
    </div>
  
</nav>


            
            
<div class="duoshuo">
	<!-- 多说评论框 start -->
	<div class="ds-thread" data-thread-key="Collection-Views" data-title="Collection Views" data-url="http://seniorzhai.github.io/2014/03/21/Collection-Views/index.html"></div>
	<!-- 多说评论框 end -->
	<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
	<script type="text/javascript">
	var duoshuoQuery = {short_name:"zt1991616"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] 
		 || document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>
	<!-- 多说公共JS代码 end -->
</div>





        </div>
    </div>
</article>
    </div>
  </main>
<div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>

<script>
var BLOG_SHARE = {
    title: "Collection Views",
    pic: "/img/logo.jpg",
    summary: document.getElementsByName('summary')[0].content,
    url: "http://seniorzhai.github.io/2014/03/21/Collection-Views/index.html"
};
</script>
<div class="global-share" id="global-share">
    <div class="tit">分享到：</div>
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" href="javascript:;" data-title="微博" data-service="tsina">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns" href="javascript:;" data-title="微信" data-service="weixin">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" href="javascript:;" data-title=" QQ" data-service="cqq">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" href="javascript:;" data-title=" Facebook" data-service="fb">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" href="javascript:;" data-title=" Twitter" data-service="twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="douban share-sns" href="javascript:;" data-title="豆瓣" data-service="douban">
          豆
        </a>
      </li>
    </ul>
 </div>



<script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>

<script src="/js/main.js"></script>



<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<script type="text/template" id="search-tpl">
<li class="item">
    <a href="/{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</script>

<script src="/js/search.js"></script>





<script src="//s95.cnzz.com/z_stat.php?id=true&web_id=true"></script>



<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-54646832-1&#39;', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->



</body>
</html>
